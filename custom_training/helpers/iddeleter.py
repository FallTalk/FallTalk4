import logging
import os
from asyncio import as_completed

import librosa
import numpy as np
from sklearn.cluster import KMeans
import shutil
from concurrent.futures import ThreadPoolExecutor
import csv
import os
import glob

# List of IDs to remove

ids_to_remove = ["0002a192_1", "0002a191_1", "001504e6_1", "000decf3_1", "0004a0fa_1", "00048d8c", "0007b29d_1",
                 "0007b29e_1", "0003febd_1", "00101b31_1", "00128cd5_1", "00128ce6_1", "001214c8_1", "0012935c_1",
                 "00129358_1", "00129371_1", "000decf3_1", "000e073d_1", "000f0cf1_1", "001de55b_1", "0003fe94_1",
                 "0003fea0_1", "0003fea3_1", "001365a6_1", "0008873b_1", "0000a180_1", "00088726_1", "00089307_1",
                 "000c87b8_1", "000c87b9_1", "000ef291_1", "0001c895_3", "0002b572_1", "000f0773_1", "000f0781_1",
                 "000f7776_1", "0002b98a_1", "0002b991_1", "0001c895_1", "0001c895_2", "0012ee4a_1", "0017efd1_1",
                 "00084e6f_1", "000849f7_1", "000886fa_1", "0001c707_3", "0001c707_4", "000886fb_1", "001e76e6_1",
                 "00167a3a_1", "00167a44_1", "000886fc_1", "0001c707_1", "0001c707_2", "0005635c_1", "000886f9_1",
                 "0008871c_1", "00128cce_1", "001b4107_1", "0002f175_1", "000169e2_1", "000169da_3", "000169db_1",
                 "000169e4_2", "000169e4_4", "000169e4_5", "000169e6_1", "000169e6_2", "000169e8_1", "000169ec_1",
                 "000169f4_1", "000169f4_2", "000169f6_1", "000169fb_1", "000180c7_1", "000180c7_2", "000207b2_1",
                 "0003ec32_1", "0004e789_1", "00019cfa_1", "00019cfd_1", "00019d01_1", "000169da_1", "000169da_2",
                 "00115769_1", "00168596_1", "0000cc46_1", "0000d8cb_1", "0000d26c_1", "000a24c3_1", "000a51a9_1",
                 "000a82cd_1", "000a170b_1", "000a171e_1", "000a1716_1", "000a7952_1", "000ae0de_1", "000b2f5f_1",
                 "000bad08_1", "000c4f0a_1", "000c4f04_1", "000c4f08_1", "000c4f09_1", "000c32a7_1", "000c8823_1",
                 "000cf913_1", "000d387e_1", "000d387f_1", "000d3880_1", "000dd389_1", "000deccb_1", "000e872c_1",
                 "000efd06_1", "000f4bca_1", "000fff54_1", "000fff55_1", "000fff56_1", "00001d16_1", "0001da67_1",
                 "0001db1b_1", "0001e5f1_1", "0001e5f2_1", "0001e5f3_1", "0001f150_1", "001ac779_1", "001b40fd_1",
                 "001b410b_1", "001b410c_1", "001b410d_1", "001b410e_1", "001b4109_1", "001c2c7b_1", "001c870a_1",
                 "001c5028_1", "001de54f_1", "001de55a_1", "001de55d_1", "001de55e_1", "001de55f_1", "001de58a_1",
                 "001de58e_1", "001de550_1", "001de551_1", "001de552_1", "001de553_1", "001de555_1", "001de556_1",
                 "001de558_1", "001de559_1", "001de560_1", "001de561_1", "001de581_1", "001de582_1", "001de586_1",
                 "001de587_1", "001e76e1_1", "001e76e3_1", "001e76e4_1", "001e76e5_1", "001ebb00_1", "0002a79e_1",
                 "0002b50e_1", "0002b090_1", "0002d822_1", "0002d824_1", "0004b985_1", "0005c2fb_1", "0005c303_1",
                 "0005c313_1", "0005fbac_1", "0006b4f4_1", "0006b4f6_1", "0006b4f7_1", "0006b4f8_1", "0006b4f9_1",
                 "0006b4fa_1", "0006b4fb_1", "0006b4fc_1", "0007b29c_1", "0008c97d_1", "0010ff2b_1", "0011f84e_1",
                 "0011f84f_1", "00017fd2_1", "0019e76d_1", "0019ee18_1", "00020d2e_1", "00020d5e_1", "00020d27_1",
                 "00021acb_1", "00021ace_1", "00023a39_1", "00030e92_1", "00032a52_1", "00037c8d_1", "00045c08_2",
                 "00046b5a_1", "00046cd6_1", "00067f99_1", "00106c7d_1", "00106c8a_1", "00106c84_1", "00108fab_1",
                 "00115b8c_1", "00121f42_1", "00121f44_1", "00121f45_1", "00121f46_1", "00122e71_1", "00122e72_1",
                 "00167a4c_1", "00167a42_1", "00183cfc_1", "00199fa6_1", "000219d2_1", "000219d3_1", "000219d4_1",
                 "000219d5_1", "000219d6_1", "000219d7_1", "000219d8_1", "000261bd_1", "000303a3_1", "000404b7_1",
                 "000470d3_1", "000512a2_1", "000512b3_1", "000512b4_1", "000512b5_1", "000512b8_1", "000512b9_1",
                 "000512d0_1", "000512d1_1", "000512d5_1", "000512d6_1", "000512e3_1", "000512e6_1", "000512e8_1",
                 "000553fe_1", "000567bb_1", "000567c5_1", "000644bb_1", "000644f0_1", "000644f2_1", "000886ea_1",
                 "000886eb_1", "000886ed_1", "000886ee_1", "000886ef_1", "000886f0_1", "000886f1_1", "000886f2_1",
                 "000886f3_1", "000886fd_1", "000886fe_1", "000886ff_1", "001000d4_1", "001000d8_1", "0001087a_1",
                 "001214df_1", "001223e5_1", "001223ec_1", "001243ec_1", "001271f4_1", "001820af_1", "001820b2_1",
                 "001820b3_1", "001820b4_1", "001820b5_1", "001820b6_1", "001982da_1", "001982e0_1", "0003039f_1",
                 "0003409b_1", "0004498e_1", "0005127a_1", "0005127c_1", "0005127e_1", "0005127f_1", "0005128e_1",
                 "0005635f_1", "0008406e_1", "0008683e_1", "0008871d_1", "0008871e_1", "0008871f_1", "0008872d_1",
                 "0008872e_1", "0008872f_1", "0008873a_1", "00010875_1", "00010876_1", "00010881_1", "0011576b_1",
                 "0015145f_1", "00032165_1", "00046923_1", "00051283_1", "00051286_1", "00051288_1", "00082134_1",
                 "00083401_1", "00083403_1", "00083404_1", "00083405_1", "00088700_1", "00088701_1", "00088702_1",
                 "00088703_1", "00088720_1", "00088721_1", "00088723_1", "00088725_1", "00088730_1", "00088732_1",
                 "00088733_1", "00088735_1", "00088736_1", "00088739_1", "00088740_1", "00112331_1", "0008661f_1",
                 "000a8ae9_1", "000a5199_1", "000b9d5c_1", "000bb95d_1", "000f15d9_1", "000f15db_1", "000f0792_1",
                 "0001f14e_1", "0002a8ff_1", "0002b518_1", "0010c83f_1", "0011fb5b_1", "001820ba_1", "001820bc_1",
                 "001999e9_1", "0013c04a_1", "0013c047_1", "0016da7b_1", "00019cf9_1", "00019cfb_1", "00019cfc_1",
                 "00019cfe_1", "00019d00_1", "00019d03_1", "00019d04_1", "00019d06_1", "00023d2a_1", "00023d2e_1",
                 "00023d2f_1", "00031aa7_1", "00040dab_1", "00045c10_1", "00149cba_1", "00152a37_1", "000169d7_1",
                 "000169df_1", "000169e0_1", "000169e3_1", "000169e4_1", "000169e7_1", "000169e9_1", "000169ee_1",
                 "000169f8_4", "000179e6_1", "000180c7_3", "000334cd_1", "000994a2_1", "0001413a_1", "001820b7_1",
                 "001820b8_1", "001820b9_1", "001820bb_1", "001820bd_1", "001820be_1", "000aa75f_1", "0001d057_1",
                 "0001f9bc_1", "001a030e_1", "001a0306_1", "001a0311_1", "001c5a0d_1", "001c5a12_1", "001e76ed_1",
                 "0002aae7_1", "00004bc2_1", "0004b13b_1", "0004b13b_2", "0006d0aa_1", "0009c8cf_1", "0012ee56_1",
                 "0002b556_1", "0002b566_1", "000a795a_1", "00045bbc_1", "0000b23f_1"  "00046955_1", "00046b59_1",
                 "0002a8ff_1", "00000ed0_1", "0000f6a6_1", "0000f6b1_1", "00085120_1", "00085123_1", "000f078a_1",
                 "001b410c_1", "001b4109_1", "001de55e_1", "001de550_1", "001de555_1", "001de557_1", "001de559_1",
                 "001de581_1", "0005c2fb_1", "0011f84e_1", "00032a52_1", "00067f99_1", "00106c7d_1", "00106c8a_1",
                 "00121f42_1", "00121f44_1", "00135ee6_1", "00183cfc_1", "000553fe_1", "000567bb_1", "001243ec_1",
                 "001505d2_1", "0005127c_1", "0005128e_1", "00010881_1", "0011576b_1", "0015145f_1", "00082134_1",
                 "00088730_1", "00115769_1", "00129379_1", "0000cc46_1", "000a170b_1", "000a171e_1", "000a7952_1",
                 "000deccb_1", "0010f1d5_1", "00012f38_1", "0012ee81_1", "0013a463_1", "0014f7bc_1", "0014f7c3_1",
                 "0014f53c_1", "0015b882_1", "0015fc62_1", "0019b63a_1", "00023afe_1", "00072ac8_1", "00140c01_1",
                 "000849fc_1", "001646d9_1", "001800f0_1", "0009946e_1", "0016473c_1", "0017411e_1", "00055962_1",
                 "00071550_1", "00156152_1", "00163298_1", "00186686_1", "00196545_1", "0000fd92_1", "000aebb7_1",
                 "000b17cf_1", "000c17d7_1", "000ca048_1", "000eec58_1", "000f4b20_1", "0001dbc6_1", "001a2e7f_1",
                 "001a0303_1", "001d8c61_1", "0003a4fd_1", "00004bc6_1", "0006e438_1", "0010a33a_1", "001ab234_1",
                 "001ac27e_1", "0017d52c_1", "00034ddf_1", "00070d4c_1", "00070d8b_1", "00070db7_1", "00091b2b_1",
                 "00091b65_1", "00119cdb_1", "00133ea1_1", "00156a58_1", "00157f2d_1", "00157f3b_1", "00157f29_1",
                 "00157f31_1", "00157f38_1", "001527d5_1", "0004821a_1", "00072689_1", "00147648_1", "00153321_1",
                 "00179175_1", "00181081_1", "00194665_1", "000a8aed_1", "000bd9ee_1", "000bd9f9_1", "000f47df_1",
                 "0001d008_1", "001ab23a_1", "001ab231_1", "001ab234_1", "001ab235_1", "001ac27e_1", "001ac28d_1",
                 "001a0306_1", "0000a316_1",
                 "001ac283_1", "001ac297_1", "0007c75d_1", "0014b03d_1", "0003ac30_1", "0000cc77_1", "001a030a_1",
                 "001a030e_1", "0000f606_1", "0018441c_1",
                 "000566b9_1",
                 "000566b9_2",
                 "000566b9_3",
                 "000566b9_4",
                 "000566b9_5",
                 "000566b9_6",
                 "000566b9_7",
                 "000566b9_8",
                 "000566b9_9",
                 "000bf933_1",
                 "000ab363_1",
                 "000abfc4_1",
                 "000b2677_1",
                 "00149cbb_1",
                 "000566b8_7",
                 "000566b8_5",
                 "000566b8_3",
                 "000566b8_4",
                 "000566b8_2",
                 "000566b8_1",
                 "000566b8_6",
                 "00023a58_1",
                 "0004498f_1",
                 "00044982_1",
                 "0002b574_1",
                 "0002b511_1",
                 "000212cc_1",
                 "0002b513_1",
                 "00128cc4_1",
                 "000404b7_1",
                 "00010583_1",
                 "0002b599_1",
                 "0001b000_1",
                 "0002b59a_1",
                 "00019ed6_1",
                 "0017696f_1",
                 "00046922_1",
                 "000470d2_1",
                 "00046cd5_1",
                 "0002b5b1_1",
                 "0004ba6d_1",
                 "0004ba6c_1",
                 "0004ba60_1",
                 "000a2d6a_1",
                 "000a2d96_1",
                 "000f0769_1",
                 "000a0efd_1",
                 "001a030b_1",
                 "001a030f_1",
                 "001a0310_1",
                 "001a0312_1",
                 "001babc9_1",
                 "001982f5_1",
                 "00157f35_1",
                 "0012ee79_1",
                 "00078565_1",
                 "0021573c_1",
                 "0019aba0_1",
                 "00132499_1",
                 "0021573c_1",
                 "0021573d_1"

                 ]


# Function to remove lines from a CSV file
def clean_csv(file_path):
    cleaned_rows = []
    with open(file_path, 'r', newline='') as infile:
        reader = csv.reader(infile, delimiter='|')
        for row in reader:
            if not any(id in row[0] for id in ids_to_remove):
                cleaned_rows.append(row)

    with open(file_path, 'w', newline='') as outfile:
        writer = csv.writer(outfile, delimiter='|')
        writer.writerows(cleaned_rows)


def delete_file(wav_file):
    if os.path.exists(wav_file):
        os.remove(wav_file)
        print(f"Deleted {wav_file}")
        return 1
    return 0

# Function to delete matching wav files
def delete_wav_files(directory):
    removed_count = 0
    with ThreadPoolExecutor() as executor:
        for id in ids_to_remove:
            # Match any wav file that contains the id in its name
            wav_files = glob.glob(os.path.join(directory, f"*{id}*.wav"))
            for wav_file in wav_files:
                executor.submit(delete_file, wav_file)

        # for wav_file in wav_files:
        #     if os.path.exists(wav_file):
        #         os.remove(wav_file)
        #         print(f"Deleted {wav_file}")
        #         removed_count = removed_count+1
    # print(f"removed {removed_count}")


def main():
    # Directories containing the CSV and wav files
    csv_directory = None
    #csv_directory = 'C:\\AI\\text-generation-webui\\extensions\\alltalk_tts\\finetune\\nate-small'
    #wav_directory1 = 'C:\\AI\\text-generation-webui\\extensions\\alltalk_tts\\finetune\\put-voice-samples-in-here'
    #wav_directory2 = 'C:\\AI\\text-generation-webui\\extensions\\alltalk_tts\\finetune\\nate-small\\wavs'


    # wav_directory2 = 'M:\\Modding\\FO4VFRT\\extracted audio\\playervoicemale01_coast'
    # Delete matching wav files in both directories

    wav_directory2 = "C:\\AI\\Datasets\\dlcnukaworld.esm\\playervoicemale01"
    delete_wav_files(wav_directory2)

    wav_directory1 = "C:\\AI\\Datasets\\dlccoast.esm\\playervoicemale01"
    delete_wav_files(wav_directory1)


    # Iterate through all CSV files in the csv_directory
    if csv_directory:
        csv_files = glob.glob(os.path.join(csv_directory, '*.csv'))
        for csv_file in csv_files:
            clean_csv(csv_file)


if __name__ == "__main__":
    main()